<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>AI 簡報產生器 (v2)</title>
  <style>
    :root{
      --bg:#f7f8fb;
      --card:#fff;
      --accent:#2563eb;
      --muted:#666;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:system-ui,-apple-system,"Segoe UI", Roboto,"Noto Sans TC", "Helvetica Neue", Arial;
      background:var(--bg);
      color:#111;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
    }
    .container{
      max-width:820px;
      margin:28px auto;
      background:var(--card);
      padding:22px;
      border-radius:10px;
      box-shadow:0 6px 18px rgba(15,23,42,0.06);
    }
    h1{margin:0 0 12px;font-size:20px}
    label{display:block;margin-top:12px;font-weight:600;font-size:14px}
    input[type="text"], textarea, select{
      width:100%;
      padding:10px 12px;
      margin-top:6px;
      border:1px solid #e6e9ef;
      border-radius:8px;
      font-size:14px;
      background:#fff;
      resize:vertical;
    }
    .radios{display:flex;gap:12px;margin-top:6px}
    .radios label{font-weight:500}
    .actions{display:flex;align-items:center;gap:12px;margin-top:14px}
    button{
      background:var(--accent);
      color:#fff;
      border:none;
      padding:10px 14px;
      border-radius:8px;
      cursor:pointer;
      font-weight:600;
    }
    button:disabled{opacity:0.6;cursor:default}
    .spinner{
      width:34px;height:34px;border-radius:50%;
      border:4px solid rgba(0,0,0,0.08);
      border-top-color:var(--accent);
      animation:spin 1s linear infinite;
    }
    .hidden{display:none}
    .status{margin-top:12px;color:var(--muted);font-size:14px}
    .result{margin-top:18px}
    #resultContent{white-space:pre-wrap;background:#fbfdff;border:1px solid #eef4ff;padding:12px;border-radius:8px}
    .pager{display:flex;align-items:center;gap:8px;margin-top:10px}
    .pager button{background:#e6eefc;color:var(--accent);padding:8px 10px;border-radius:6px;border:none}
    @keyframes spin{from{transform:rotate(0)}to{transform:rotate(360deg)}}
  </style>
</head>
<body>
  <div class="container">
    <h1>AI 簡報產生器 (v2)</h1>

    <form id="reportForm">
      <label>簡報主題 (必填)</label>
      <input id="title" name="title" type="text" placeholder="例如：AI 對未來工作的影響" required />

      <label>貼上您的現有資料（選填）</label>
      <textarea id="textData" name="textData" rows="6" placeholder="將您的筆記、草稿或任何相關文字貼在這裡..."></textarea>

      <label>或上傳 .txt 純文字檔案</label>
      <input id="fileInput" type="file" accept=".txt" />

      <label>希望頁數</label>
      <select id="pages" name="pages">
        <option value="3">3 頁（精簡）</option>
        <option value="5" selected>5 頁（標準）</option>
        <option value="7">7 頁（詳細）</option>
      </select>

      <label>內容豐富度</label>
      <div class="radios">
        <label><input type="radio" name="richness" value="concise" checked/> 精簡</label>
        <label><input type="radio" name="richness" value="balanced" /> 適中</label>
        <label><input type="radio" name="richness" value="verbose" /> 豐富</label>
      </div>

      <div class="actions">
        <button id="generateBtn" type="submit">生成簡報</button>
        <div id="spinner" class="spinner hidden" aria-hidden="true"></div>
      </div>
    </form>

    <div id="status" class="status"></div>

    <div id="resultArea" class="result hidden">
      <h2>生成結果</h2>
      <div id="resultContent"></div>
      <div class="pager">
        <button id="prevPage">← 上一頁</button>
        <span id="pageIndicator">第 1 / 1 頁</span>
        <button id="nextPage">下一頁 →</button>
      </div>
    </div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const form = document.getElementById('reportForm');
      const generateBtn = document.getElementById('generateBtn');
      const spinner = document.getElementById('spinner');
      const status = document.getElementById('status');
      const resultArea = document.getElementById('resultArea');
      const resultContent = document.getElementById('resultContent');

      async function readFileAsText(file){
        return new Promise((res, rej) => {
          const r = new FileReader();
          r.onload = () => res(r.result);
          r.onerror = () => rej(new Error('檔案讀取失敗'));
          r.readAsText(file, 'UTF-8');
        });
      }

      form.addEventListener('submit', async (e) => {
        e.preventDefault();
        generateBtn.disabled = true;
        spinner.classList.remove('hidden');
        status.textContent = 'AI 正在生成中，請稍候... (可能需要 10-20 秒)';
        resultArea.classList.add('hidden');
        resultContent.textContent = '';

        try {
          const title = document.getElementById('title').value.trim();
          const textData = document.getElementById('textData').value.trim();
          const fileInput = document.getElementById('fileInput');
          const pages = document.getElementById('pages').value;
          const richness = document.querySelector('input[name="richness"]:checked').value;

          if (!title) throw new Error('請輸入簡報主題');

          let uploadedText = '';
          if (fileInput.files && fileInput.files.length > 0){
            uploadedText = await readFileAsText(fileInput.files[0]);
          }

          const payload = { title, pages, richness, textData, uploadedText };

          const resp = await fetch('/api/generate', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(payload)
          });

          if (!resp.ok) {
            const errText = await resp.text();
            throw new Error('伺服器回應錯誤：' + errText);
          }

          const data = await resp.json();
          if (data.error) throw new Error(data.error);

          resultContent.textContent = data.result || JSON.stringify(data, null, 2);
          resultArea.classList.remove('hidden');
          status.textContent = '生成完成';
        } catch (err) {
          status.textContent = '發生錯誤：' + (err.message || err);
        } finally {
          generateBtn.disabled = false;
          spinner.classList.add('hidden');
        }
      });
    });
  </script>
</body>
</html>
